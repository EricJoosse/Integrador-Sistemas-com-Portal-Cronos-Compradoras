Manual instalação e uso da Ponte Java para consumir web services do Portal Cronos
=================================================================================

Objetivo:
=========
A ponte Java neste projeto é um complemento para sistemas que usam linguagens de programação incompletas 
que não conseguem fazer upload de arquivos, como por exemplo o Datasul que usa a linguagem POSTGRE.


A. Instalação:
==============

Para evitar bloqueio de anexos de arquivos com extensão .jar por provedores de email,
a ponte Java está disponível para download no link http://52.170.47.238/Ponte_Java_Integração_PCronos_v2.1.1.zip. 
 
Este arquivo .zip deve ser descompactado mantendo a mesma estrutura de subdiretórios que têm dentro deste arquivo zippado.
Isso quer dizer: copiar o arquivo zippado da ponte nova para o diretório onde a ponte deve ficar, 
e descompactar o arquivo zip estando neste diretório. 

Observação:
NÂO coloque a ponte Java nem as libs no diretório do próprio Java. 
Este diretório é um diretório reservado apenas para a instalação de Java.
 


B.1. Uso da ponte sem MS-DOS:
=============================

É só chamar o método "uploadStringXML" na classe "PonteWebServicesPortalCronos"  na package "pcronos.integracao.comprador".
Parâmetros: 
	- String url, 
	- String stringXML, 
	- String usuario, 
	- String senha, 
	- Boolean toDebugar.
O parâmetro "toDebugar" (true/false/-) é opcional, com default = false. Os demais parâmetros são obrigatórios. 
 
Este método retorna um objeto de tipo pcronos.integracao.comprador.RetornoWebServiceDTO com os seguintes campos:
  - String StatusCodeHTTP: pode ser 200, 202, ....., veja o manual de Integração
  - String MensagensXML: string XML com a lista de eventuais erros que pode estar vazio, 
Este objeto está apenas repassando o retorno do web service, veja o manual de Integração. 
 
Observações: 
1. A ponte Java é independente do web service do Portal Cronos e pode ser usada
    para upload de qualquer arquivo XML para qualquer web service do Portal Cronos
    como por exemplo "PostFileRequisicao", "PostFileRecebimentoOrdemCompra", "PostFileSituacaoOrdemCompra", etc.
 
2. A ponte faz limpeza automática do subdiretório C:/ProgramData/PortalCronos/PonteJava/ que é um subdiretório 
   para uso interno pela ponte. A ponte guarda os arquivos internos 30 dias. 
   
3. A ponte foi feita e testada para funcionar até com versões antigas de Java como Java 1.7.
   Também tem outra versão mais moderna da ponte disponível para Java 1.8 e maior.
 
 
Opções:
------- 
B.1.1. O ideal seria que o sistema a ser integrado com o Portal Cronos já teria uma infra-estrutura pronta, 
       dentro ou fora do sistema, para executar métodos Java em arquivos .jar, de forma embutida no sistema,
       sem precisarr do método "main" da ponte.  

B.1.2. Caso contrário, talvez você pode baixar algum plugin da Internet e instalar o plugin
       no Datasul para executar métodos java externos?
 
B.1.3. Ou talvez você pode passar o string XML por fora da chamada da ponte Java via arquivos intermediários, 
       sem usar MS-DOS, ou via tabelas intermediários ou via bibliotecas de terceiros como por exemplo Groovy ou Beanshell. 
       Neste caso favor entrar em contato com o setor Desenvolvimento do Portal Cronos para adaptação da ponte Java.

B.1.4. Caso contrário, como última opção (menos ideal), a Cronos Technology já tem uma infra-estrutura pronta 
       que usa MS-DOS e um método "main", passando o string XML por fora da chamada da ponte Java via arquivos intermediários. 
       Neste último caso veja a opção B.2 abaixo. 
  

 
B.2. Uso da ponte com MS-DOS:
=============================

Criar um arquivo .bat com o seguinte conteúdo:
 
REM Navegar para o diretório onde fica a ponte, e de lá executar java.exe:
cd\
cd dir1
cd dir2
cd .......
REM Antigo - com diretórios flexíveis:
REM "%JAVA_HOME%\bin\java.exe"   -cp  ponte-integracao-pcronos-2.1.1.jar  pcronos.integracao.comprador.PonteWebServicesPortalCronos  "url"   usuario  senha  "dirMaisNomeArqUploadXML"   "dirMaisNomeArqRetornoXML"   "dirMaisNomeArqRetornoStatusCodeHTTP"  toDebugar
 
REM Versão atual - com um único diretório fixo:
"%JAVA_HOME%\bin\java.exe"  -cp  ponte-integracao-pcronos-2.1.1.jar  pcronos.integracao.comprador.PonteWebServicesPortalCronos  "url"   usuario  senha  NomeArqUploadXML   NomeArqRetornoXML   ArqRetornoStatusCodeHTTP  toDebugar

REM Descomentar o seguinte para testar ou debugar os arquivos de retorno:
REM echo.
REM type C:\ProgramData\PortalCronos\<NomeArqRetornoXML>
REM type C:\ProgramData\PortalCronos\<ArqRetornoStatusCodeHTTP>


Exemplo:
--------
REM Navegar para o diretório onde fica a ponte, e de lá executar java.exe:
cd\
cd dir1
cd dir2
cd .......

"%JAVA_HOME%\bin\java.exe"  -cp  ponte-integracao-pcronos-2.1.1.jar  pcronos.integracao.comprador.PonteWebServicesPortalCronos "http://www.portalcronos.com.br:81/v2/api/Requisicao/PostFileRequisicao" ws-sjcc 123456 req_10798130000175_243680_20200724_145856.xml Ret_10798130000175_243680_20200724_145856.xml Status_10798130000175_243680_20200724_145856.txt false

REM Descomentar o seguinte para testar ou debugar os arquivos de retorno:
REM echo.
REM type C:\ProgramData\PortalCronos\Ret_10798130000175_243680_20200724_145856.xml
REM type C:\ProgramData\PortalCronos\Status_10798130000175_243680_20200724_145856.txt

 
Observações:
------------
1. O parâmetro "url" deve ser passado com aspas duplas, veja o exemplo acima;
 
2. Dentro do parâmetro "url" é melhor usar os caracteres "/"  e não os caracteres "\" para evitar a necessidade de usar "escape characters".
 
3. O parâmetro "toDebugar" (true/false/-) é opcional, com default = false. Os demais parâmetros são obrigatórios. 
   
4. A ponte Java é independente do web service do Portal Cronos e pode ser usada
    para upload de qualquer arquivo XML para qualquer web service do Portal Cronos
    como por exemplo "PostFileRequisicao", "PostFileRecebimentoOrdemCompra", "PostFileSituacaoOrdemCompra", etc.
 
5. Na versão atual da ponte o diretório para os 3 tipos de arquivos é um diretório único e um diretório fixo no programa. 
   O diretório fixo é C:/ProgramData/PortalCronos/ e não é C:/temp/ para evitar prejuizos graves e até paradas impeditivas 
   da integração no futuro. O diretório "C:/ProgramData/" é o diretório padrão Microsoft para arquivos temporários de programas. 
   
6. A ponte mesma cria os 2 tipos de arquivos de retorno fisicamente se não existir arquivos com estes nomes.
   O sistema que integra com o Portal Cronos apenas deve passar os NOMES dos arquivos de retorno e após a chamada da ponte 
   fazer a leitura destes mesmos arquivos de retorno. 
 
7. Os nomes dos arquivos de retorno devem ser diferentes em cada chamada da ponte 
   para impossibilitar interferência indevida de requisições diferentes.
 
8. A ponte faz limpeza automática do subdiretório C:/ProgramData/PortalCronos/PonteJava/ que é um subdiretório 
   para uso interno pela ponte. A ponte guarda os arquivos internos 30 dias. 
   O diretório raiz  C:/ProgramData/PortalCronos/ é para uso pelo sistema que integra com o Portal Cronos. 
   A ponte não faz limpeza automática deste diretório raiz. 
   
9. A ponte foi feita e testada para funcionar até com versões antigas de Java como Java 1.7.
   Também tem outra versão mais moderna da ponte disponível para Java 1.8 e maior.
 
10. Java pode receber parâmetros de qualquer tamanho e não tem nenhum limite para a quantidade de caracteres, 
    porém não seria uma boa ideia substituir o uso de arquivos no parâmetro "NomeArqRetornoXML" 
    por outro parâmetro "stringXML" passando um string XML direto para a ponte, 
    pois MS-DOS tem um limite de 2048 ou 8191 caracteres para linhas de comando DOS, dependendo da versão de Windows. 
    Além disso, o uso de arquivos evita problemas com aspas, aspas duplas, espaços em branco e barras / e \
    e evita a necessidade do uso de "escape characters" '\' antes de cada aspa ou aspa dupla e barra. 
    Pelo menos nas versões de MS-DOS até 2020 não existe nenhuma configuração ou comando DOS para aumentar 
    este limite de 2048 ou 8191 caracteres. 
     
  
C. No caso de outra versão de Java diferente de 1.7 ou 1.8:
===========================================================

Em caso de erros, favor entrar em contato com o setor Desenvolvimento do Portal Cronos para ver se a ponte Java 
dá para ser adaptada para outra versão de Java.
Caso contrário, como última opção, teremos que instalar a versão homologada Java 1.8.92 no servidor 
em paralelo com a versão antiga 1.7, sem quebrar nem prejudicar nenhum sistema já existente no servidor, 
e sem nenhuma interferência. 
Neste caso o setor Desenvolvimento do Portal Cronos poderá escrever um manualzinho como fazer isso exatamente. 

     