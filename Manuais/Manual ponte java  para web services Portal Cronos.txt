Manual instalação e uso da Ponte Java
=====================================

A ponte Java neste projeto é um complemento para sistemas que usam linguagens de programação incompletas 
que não conseguem fazer upload de arquivos, como por exemplo o Datasul que usa a linguagem POSTGRE.


A. Instalação:
==============

A ponte Java se encontra no link http://52.170.47.238/PonteJavaIntegraçãoPCronos.2.1.1.zip, 
feita com a mesma versão antiga 1.7 de Java que o JBoss da TOTVS usa. 
 
Favor descompactar este arquivo .zip mantendo a mesma estrutura de subdiretórios que têm dentro deste arquivo zippado.
Isso quer dizer: copiar o arquivo zippado da ponte nova para o diretório onde a ponte deve ficar 
(D:\totvs\projetos-datasul11\ccp001\Includes\ nos servidores do Datasul), e descompactar o arquivo zip estando neste diretório. 

Observação:
NÂO coloque a ponte Java nem as libs no diretório do próprio Java. Este diretório é um diretório reservado apenas para a instalação de Java.
 



B.1. Uso da ponte sem MS-DOS:
=============================

Carlos Eduardo, boa tarde!
 
  a "ponte" Java está disponível. Já testei esta ponte agorinha e funcionou. 
Para evitar bloqueio de anexos de arquivos .jar por providores de email,
a ponte está disponível para download no link http://52.170.47.238/ponte-integracao-pcronos-2.1.1.jar
 
É só chamar o método "uploadStringXML" na classe "PonteWebServicesPortalCronos"  na package "pcronos.integracao.comprador".
Parâmetros: String url, String stringXML, String usuario, String senha, Boolean toDebugar.
O parâmetro "toDebugar" (true/false/-) é opcional, com default = false. Os demais parâmetros são obrigatórios. 
Este método retorna um objeto de tipo pcronos.integracao.comprador.RetornoWebServiceDTO com os seguintes campos:
  - String StatusCodeHTTP: pode ser 200, 202, ....., veja o manual de Integração
  - String MensagensXML: string XML com a lista de eventuais erros que pode estar vazio, 
    apenas repassando o retorno do web service, veja o manual de Integração; 
 
Observações: 
1. A versão atual da ponte não chama o método "main".
 
2. A ponte faz limpeza automática do subdiretório C:/ProgramData/PortalCronos/PonteJava/ que é um subdiretório 
   para uso interno pela ponte. A ponte guarda os arquivos internos 30 dias. 
   
3. A ponte foi feita e testada para funcionar até com versões antigas de Java como Java 1.7.
   Também tem uma versão disponível para Java 1.8 e mais.
 
 
Espero que vocês já têm uma infra-estrutura pronta, dentro ou fora do Datasul, para executar qualquer método java em qualquer arquivo .jar diferente de métodos "main", 
pois isso seria o ideal. 
Caso contrário, a Cronos Technology já tem uma infra-estrutura pronta que usa MS-DOS e um método "main".
Neste caso pode entrar em contato com a Cronos para obter esta infra-estrutura. 
  
Atc,
Eric
 
 
B.2. Uso da ponte com MS-DOS:
=============================

REM Navegar para o diretório onde fica a ponte, e de lá executar java.exe:
cd\
cd dir1
cd dir2
cd .......
REM Antigo - com diretórios flexíveis:
REM "%JAVA_HOME%\bin\java.exe"   -cp  ponte-integracao-pcronos-2.1.1.jar  pcronos.integracao.comprador.PonteWebServicesPortalCronos  "url"   usuario  senha  "dirMaisNomeArqUploadXML"   "dirMaisNomeArqRetornoXML"   "dirMaisNomeArqRetornoStatusCodeHTTP"  toDebugar
 
REM Versão atual - com um único diretório fixo:
"%JAVA_HOME%\bin\java.exe"  -cp  ponte-integracao-pcronos-2.1.1.jar  pcronos.integracao.comprador.PonteWebServicesPortalCronos  "url"   usuario  senha  NomeArqUploadXML   NomeArqRetornoXML   ArqRetornoStatusCodeHTTP  toDebugar


Exemplo:
--------
REM Navegar para o diretório onde fica a ponte, e de lá executar java.exe:
cd\
cd dir1
cd dir2
cd .......

"%JAVA_HOME%\bin\java.exe"  -cp  ponte-integracao-pcronos-2.1.1.jar  pcronos.integracao.comprador.PonteWebServicesPortalCronos "http://www.portalcronos.com.br:81/v2/api/Requisicao/PostFileRequisicao" ws-sjcc 123456 req_10798130000175_243680_20200724_145856.xml Ret_10798130000175_243680_20200724_145856.xml Status_10798130000175_243680_20200724_145856.txt false
REM Descomentar o seguinte para testar ou debugar os arquivos de retorno:
REM echo.
REM type C:\ProgramData\PortalCronos\Ret_10798130000175_243680_20200724_145856.xml
REM type C:\ProgramData\PortalCronos\Status_10798130000175_243680_20200724_145856.txt

 
Observações:
------------
1. O parâmetro "url" deve ser passado com aspas duplas, veja o exemplo acima;
 
2. Dentro do parâmetro "url" é melhor usar os caracteres /  e não \ para não precisar de "escape characters".
 
3. A ponte Java é independente do web service do Portal Cronos e pode ser usado
    para upload de qualquer arquivo XML para qualquer web service do Portal Cronos
    como por exemplo "PostFileRequisicao", "PostFileRecebimentoOrdemCompra", "PostFileSituacaoOrdemCompra", etc.
 
4. Na versão atual da ponte o diretório para os 3 tipos de arquivos é um diretório único e um diretório fixo no programa. 
   O diretório fixo é C:/ProgramData/PortalCronos/ e não é C:/temp/ para evitar prejuizos graves e até paradas impeditivas 
   da integração no futuro.
   
5. A ponte mesma cria os 2 tipos de arquivos de retorno fisicamente se não existir arquivos com estes nomes.
   O sistema que integra com o Portal Cronos apenas deve passar os NOMES dos arquivos de retorno e após a chamada da ponte 
   fazer a leitura destes mesmos arquivos de retorno. 
 
6. Os nomes dos arquivos de retorno devem ser diferentes em cada chamada da ponte 
   para evitar interferência indevida de requisições diferentes.
 
7. A ponte faz limpeza automática do subdiretório C:/ProgramData/PortalCronos/PonteJava/ que é um subdiretório 
   para uso interno pela ponte. A ponte guarda os arquivos internos 30 dias. 
   O diretório raiz  C:/ProgramData/PortalCronos/ é para uso pelo sistema que integra com o Portal Cronos. 
   A ponte não faz limpeza automática deste diretório raiz. 
   
8. O parâmetro "toDebugar" (true/false/-) é opcional, com default = false. Os demais parâmetros são obrigatórios. 
   
9. A ponte foi feita e testada para funcionar até com versões antigas de Java como Java 1.7.
   Também tem uma versão disponível para Java 1.8 e mais.
 
10. Java pode receber parâmetros de qualquer tamanho e não tem nenhum limite para a quantidade de caracteres, 
    porém não seria uma boa ideia substituir o uso de aquivos no parâmetro "NomeArqRetornoXML" 
    passando um string de XML direto para a ponte, pois MS-DOS tem um limite de 2048 ou 8191 caracteres 
    para linhas de comando DOS, dependendo da versão de Windows. 
    Além disso, o uso de arquivos evita problemas com aspas, aspas duplas, espaços em branco e barras / e \
    e com "escape characters". 
    Não existe nenhuma configuração ou comando DOS para aumentar este limite. 
     
   
(  ) Enviar ainda para Carlos da Datasul:
 
Carlos, bom dia!
  
  me esqueci dizer que a ponte faz limpeza automática do subdiretório C:/ProgramData/PortalCronos/PonteJava/ 
que é um subdiretório para uso interno pela ponte. A ponte guarda os arquivos internos 30 dias. 
O diretório raiz  C:/ProgramData/PortalCronos/ é para uso pelo sistema que integra com o Portal Cronos. 
A ponte não faz limpeza automática deste diretório raiz.
 
Dúvida: 
O seu programa faz esta limpeza automática dos arquivos que o Datasul gera? 
Caso contrário, eu mesmo posso fazer isso dentro da ponte, eu faria isso em 5 minutos com apenas uma linha de programação Java. 
 
Eric
 
  
     